<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Spatial Interpolation via Inverse Path Distance Weighting • ipdw</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Spatial Interpolation via Inverse Path Distance Weighting">
<meta property="og:description" content="ipdw">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ipdw</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0-0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/ipdw2.html">Spatial Interpolation via Inverse Path Distance Weighting</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jsta/ipdw/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="ipdw2_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Spatial Interpolation via Inverse Path Distance Weighting</h1>
                        <h4 data-toc-skip class="author">J. Stachelek</h4>
                        
            <h4 data-toc-skip class="date">2022-12-27</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/jsta/ipdw/blob/HEAD/vignettes/ipdw2.Rmd" class="external-link"><code>vignettes/ipdw2.Rmd</code></a></small>
      <div class="hidden name"><code>ipdw2.Rmd</code></div>

    </div>

    
        <div class="abstract">
      <p class="abstract">Abstract</p>
      The <code>R</code> package <code>ipdw</code> provides functions for interpolation of georeferenced point data via Inverse Path Distance Weighting. Useful for coastal marine applications where barriers in the landscape preclude interpolation with Euclidean distances. This method of interpolation requires significant computation and is only practical for relatively small and coarse grids. The <code>ipdw</code> implementation may provide additional flexibility and greater speed relative to alternatives.
    </div>
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette describes <code>ipdw</code>, an <code>R</code> package which provides the functionality to perform interpolation of georeferenced point data using inverse path distance weighting <span class="citation">(Suominen, Tolvanen, and Kalliola 2010)</span>. Interpolation is accomplished in two steps. First, path distances are calculated from each georeferenced (measurement) point to each prediction point. Path distances, which honor barriers in the landscape, are calculated based on cell-to-cell movement through an underlying <code>Raster</code> object <span class="citation">(Hijmans 2014)</span> that represents movement cost. These path distances are subsequently used as interpolation weights. The two-step routine follows the order of operations described in <span class="citation">Suominen, Tolvanen, and Kalliola (2010)</span> substituting the ESRI path distance algorithm <span class="citation">Mitchell (2012)</span> with the <code>gdistance</code> <span class="citation">(Etten 2014)</span> wrapped version of the <code>igraph</code> <span class="citation">(Csardi and Nepusz 2006)</span> adjacency algorithm.</p>
<p>The <code>ipdw</code> package was developed with coastal marine applications in mind where path distances (as the fish swims) rather than Euclidean (as the crow flies) distances more accurately represent spatial connectivity <span class="citation">(Little, Edwards, and Porter 1997)</span>. Interpolation of sparse grids in coastal areas otherwise end up bleeding through land areas <span class="citation">(Stachelek and Madden 2015)</span>. The remainder of this vignette provides an example of such a situation using the Kattegat salinity dataset <span class="citation">(Diggle and Lophaven 2006)</span> found within the <code>geoR</code> package.</p>
</div>
<div class="section level2">
<h2 id="data-preparation">Data Preparation<a class="anchor" aria-label="anchor" href="#data-preparation"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jsta/ipdw" class="external-link">ipdw</a></span><span class="op">)</span></span></code></pre></div>
<p>To begin, we need to load an object representing point observations as either a matrix of coordinates or a <code>SpatialPointsDataFrame</code> object and an object representing a coastline as a <code>SpatialPolygonsDataFrame</code> object. The data for this demonstration come from a built-in dataset in the <code>geoR</code> package for the Kattegat basin of Denmark (see <code>?geoR::kattegat</code>).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://rgdal.r-forge.r-project.org" class="external-link">rgdal</a></span><span class="op">)</span></span>
<span><span class="va">pols</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://rgdal.r-forge.r-project.org/reference/rgdal-deprecated.html" class="external-link">readOGR</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/kattegat_coast.gpkg"</span>, package <span class="op">=</span> <span class="st">"ipdw"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: OGR support is provided by the sf and terra packages among others</span></span></code></pre>
<pre><code><span><span class="co">## Warning: OGR support is provided by the sf and terra packages among others</span></span></code></pre>
<pre><code><span><span class="co">## Warning: OGR support is provided by the sf and terra packages among others</span></span></code></pre>
<pre><code><span><span class="co">## Warning: OGR support is provided by the sf and terra packages among others</span></span></code></pre>
<pre><code><span><span class="co">## Warning: OGR support is provided by the sf and terra packages among others</span></span></code></pre>
<pre><code><span><span class="co">## Warning: OGR support is provided by the sf and terra packages among others</span></span></code></pre>
<pre><code><span><span class="co">## Warning: OGR support is provided by the sf and terra packages among others</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pnts</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://rgdal.r-forge.r-project.org/reference/rgdal-deprecated.html" class="external-link">readOGR</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/kattegat_pnts.gpkg"</span>, package <span class="op">=</span> <span class="st">"ipdw"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: OGR support is provided by the sf and terra packages among others</span></span></code></pre>
<pre><code><span><span class="co">## Warning: OGR support is provided by the sf and terra packages among others</span></span></code></pre>
<pre><code><span><span class="co">## Warning: OGR support is provided by the sf and terra packages among others</span></span></code></pre>
<pre><code><span><span class="co">## Warning: OGR support is provided by the sf and terra packages among others</span></span></code></pre>
<pre><code><span><span class="co">## Warning: OGR support is provided by the sf and terra packages among others</span></span></code></pre>
<pre><code><span><span class="co">## Warning: OGR support is provided by the sf and terra packages among others</span></span></code></pre>
<pre><code><span><span class="co">## Warning: OGR support is provided by the sf and terra packages among others</span></span></code></pre>
<p>We can use this <code>SpatialPolygons</code> object to create a cost raster defining travel through land areas with a very high cost. As a result, interpolation neighborhoods will be defined based on in-water rather than Euclidean distances. Cost raster creation is accomplished with the <code>ipdw</code> function <code>costrasterGen</code>. By default, open water areas are set to a per unit travel cost of 1 whereas land areas are set to a per unit travel cost of 10,000. Note that a projection is defined for the <code>costrasterGen</code> function by the <code>projstr</code> parameter. It is critical to check the resolution of the cost raster before proceeding. The resolution of the cost raster will determine the resolution of the interpolated output. If the resolution is too fine, this will result in very long processing times. If necessary, coarsen the cost raster with the <code>raster</code> function <code>aggregate</code>.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">costras</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/costrasterGen.html">costrasterGen</a></span><span class="op">(</span><span class="va">pnts</span>, <span class="va">pols</span>, extent <span class="op">=</span> <span class="st">"pnts"</span>,</span>
<span>  projstr <span class="op">=</span> <span class="fu">projection</span><span class="op">(</span><span class="va">pols</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># insert contiguous barrier</span></span>
<span><span class="va">costras</span><span class="op">[</span><span class="fl">160</span><span class="op">:</span><span class="fl">170</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">80</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">10000</span></span></code></pre></div>
<p>In order to evaluate the utility of IPDW, we split the dataset into seperate training and validation datasets. The training dataset is created in a spatially balanced manner by building a grid and randomly selecting one measurement point per grid cell. In the following code block, the size of this grid is defined as 2 times the average distance among measurement points. Average distance is computed using the <code>spatstat</code> package <span class="citation">(Baddeley and Turner 2005)</span>. Random selection is accomplished with the <code>gdata</code> function <code>resample</code> <span class="citation">(Warnes et al. 2014)</span>. Subsetting the full dataset is not required to run <code>ipdw</code>. Alternative means of estimating interpolation errors, such as leave-one-out cross validation, are in development.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># find average nearest neighbor</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://spatstat.org/" class="external-link">spatstat</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">W</span>              <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/spatstat.geom/man/owin.html" class="external-link">owin</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/sp/man/coordinates.html" class="external-link">coordinates</a></span><span class="op">(</span><span class="va">pnts</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/sp/man/coordinates.html" class="external-link">coordinates</a></span><span class="op">(</span><span class="va">pnts</span><span class="op">)</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">kat.pp</span>         <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/spatstat.geom/man/ppp.html" class="external-link">ppp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/sp/man/coordinates.html" class="external-link">coordinates</a></span><span class="op">(</span><span class="va">pnts</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/pkg/sp/man/coordinates.html" class="external-link">coordinates</a></span><span class="op">(</span><span class="va">pnts</span><span class="op">)</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, window <span class="op">=</span> <span class="va">W</span><span class="op">)</span></span>
<span><span class="va">mean.neighdist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/spatstat.geom/man/nndist.html" class="external-link">nndist</a></span><span class="op">(</span><span class="va">kat.pp</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># grid building</span></span>
<span><span class="va">gridsize</span>       <span class="op">&lt;-</span> <span class="va">mean.neighdist</span> <span class="op">*</span> <span class="fl">2</span></span>
<span><span class="va">grainscale.fac</span> <span class="op">&lt;-</span> <span class="va">gridsize</span> <span class="op">/</span> <span class="fu">res</span><span class="op">(</span><span class="va">costras</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">gridras</span>        <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">costras</span>, fact <span class="op">=</span> <span class="va">grainscale.fac</span><span class="op">)</span></span>
<span><span class="va">gridpol</span>        <span class="op">&lt;-</span> <span class="fu">rasterToPolygons</span><span class="op">(</span><span class="va">gridras</span><span class="op">)</span></span>
<span><span class="va">gridpol</span><span class="op">$</span><span class="va">value</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">gridpol</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># spatial join</span></span>
<span><span class="va">fulldataset.over</span>    <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sp/man/over.html" class="external-link">over</a></span><span class="op">(</span><span class="va">pnts</span>, <span class="va">gridpol</span><span class="op">)</span></span>
<span><span class="va">fulldataset.over</span>    <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">fulldataset.over</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">pnts</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"salinity"</span>, <span class="st">"x.utm"</span>, <span class="st">"y.utm"</span>, <span class="st">"optional"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># grid selection</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">gridlev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">fulldataset.over</span><span class="op">$</span><span class="va">value</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">gridlev</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">activesub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">fulldataset.over</span>, <span class="va">fulldataset.over</span><span class="op">$</span><span class="va">value</span> <span class="op">==</span> <span class="va">gridlev</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">selectnum</span> <span class="op">&lt;-</span> <span class="fu">gdata</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gdata/man/resample.html" class="external-link">resample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">activesub</span><span class="op">)</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">i</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">training</span> <span class="op">&lt;-</span> <span class="va">activesub</span><span class="op">[</span><span class="va">selectnum</span>, <span class="op">]</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">training</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">training</span>, <span class="va">activesub</span><span class="op">[</span><span class="va">selectnum</span>, <span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Next, we save the training and validation datasets as objects of class <code>SpatialPointsDataFrame</code>. Note that the projection of the training and validation datasets matches the cost raster we created previously. Calculations within the <code>ipdw</code> package require projected datasets. More about <code>R</code> projections can be found from the PROJ.4 documentation at the Open Source Geospatial Foundation (<a href="https://proj4.org" class="external-link uri">https://proj4.org</a>).</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">validate</span>             <span class="op">&lt;-</span> <span class="va">fulldataset.over</span><span class="op">[</span><span class="op">!</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">fulldataset.over</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">training</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="va">xy</span>                   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">training</span><span class="op">$</span><span class="va">x.utm</span>, <span class="va">training</span><span class="op">$</span><span class="va">y.utm</span><span class="op">)</span></span>
<span><span class="va">training</span>             <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sp/man/SpatialPoints.html" class="external-link">SpatialPointsDataFrame</a></span><span class="op">(</span><span class="va">xy</span>, <span class="va">training</span><span class="op">)</span></span>
<span><span class="va">xy</span>                   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">validate</span><span class="op">$</span><span class="va">x.utm</span>, <span class="va">validate</span><span class="op">$</span><span class="va">y.utm</span><span class="op">)</span></span>
<span><span class="va">validate</span>             <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sp/man/SpatialPoints.html" class="external-link">SpatialPointsDataFrame</a></span><span class="op">(</span><span class="va">xy</span>, <span class="va">validate</span><span class="op">)</span></span>
<span><span class="fu">projection</span><span class="op">(</span><span class="va">training</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">projection</span><span class="op">(</span><span class="va">pnts</span><span class="op">)</span></span>
<span><span class="fu">projection</span><span class="op">(</span><span class="va">validate</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">projection</span><span class="op">(</span><span class="va">pnts</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">costras</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">training</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">validate</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="ipdw2_files/figure-html/plot_cost_raster-1.png" alt="&lt;strong&gt;Figure 1: Cost raster representing the high cost of travel through land areas. Training and validation points are shown in black and red respectively.&lt;/strong&gt;" width="480"><p class="caption">
<strong>Figure 1: Cost raster representing the high cost of travel through land areas. Training and validation points are shown in black and red respectively.</strong>
</p>
</div>
</div>
<div class="section level2">
<h2 id="interpolation">Interpolation<a class="anchor" aria-label="anchor" href="#interpolation"></a>
</h2>
<p>We have assembled an object of class <code>SpatialPointsDataFrame</code> to be interpolated and an underlying cost raster of class <code>Raster</code>. We can either proceed in a single step using the high-level <code>ipdw</code> function <code>ipdw</code> or in two steps using calls to the <code>pathdistGen</code> and <code>ipdwInterp</code> functions. For simplicity, the single step option, <code>ipdw</code>, is shown below. The two step option would be useful for the case where we want interpolate multiple parameters of the same <code>SpatialPointsDataFrame</code> object using a single <code>RasterStack</code> of path distances.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">paramlist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"salinity"</span><span class="op">)</span></span>
<span><span class="va">final.ipdw</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ipdw.html">ipdw</a></span><span class="op">(</span><span class="va">training</span>, <span class="va">costras</span>, range <span class="op">=</span> <span class="va">mean.neighdist</span> <span class="op">*</span> <span class="fl">10</span>, <span class="va">paramlist</span>,</span>
<span>  overlapped <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">final.ipdw</span>, main <span class="op">=</span> <span class="st">"Kattegat salinity (ppt)"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="ipdw2_files/figure-html/plot_interpolation-1.png" alt="&lt;strong&gt;Figure 2: Interpolated salinity surface by IPDW.&lt;/strong&gt;" width="480"><p class="caption">
<strong>Figure 2: Interpolated salinity surface by IPDW.</strong>
</p>
</div>
</div>
<div class="section level2">
<h2 id="comparison-with-inverse-distance-weighting">Comparison with Inverse Distance Weighting<a class="anchor" aria-label="anchor" href="#comparison-with-inverse-distance-weighting"></a>
</h2>
<p>We can evaluate the benefits of IPDW by comparing its output against Inverse Distance Weighting with Euclidean distances. The following section generates an interpolated surface via IDW. First, prediction points are generated. Then the <code>gstat</code> <span class="citation">(Pebesma 2004)</span> IDW functionality is called with the same inputs as the previous section above. Differences between the outputs of two methodologies are shown in Figure 2.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">idw.grid</span> <span class="op">&lt;-</span> <span class="fu">rasterToPoints</span><span class="op">(</span><span class="va">costras</span>, fun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;</span> <span class="fl">10000</span></span>
<span><span class="op">}</span>, spatial <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/sp/man/gridded-methods.html" class="external-link">gridded</a></span><span class="op">(</span><span class="va">idw.grid</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span><span class="va">kat.idw</span> <span class="op">&lt;-</span> <span class="fu">gstat</span><span class="fu">::</span><span class="fu">idw</span><span class="op">(</span><span class="va">salinity</span> <span class="op">~</span> <span class="fl">1</span>, <span class="va">training</span>, <span class="va">idw.grid</span>, maxdist <span class="op">=</span> <span class="va">mean.neighdist</span> <span class="op">*</span> <span class="fl">10</span>,</span>
<span>  debug.level <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">final.idw</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="op">(</span><span class="va">kat.idw</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5.1</span>, <span class="fl">4.1</span>, <span class="fl">4.1</span>, <span class="fl">5.1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">final.ipdw</span>, main <span class="op">=</span> <span class="st">"IPDW"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">final.idw</span>, main <span class="op">=</span> <span class="st">"IDW"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">final.idw</span> <span class="op">-</span> <span class="va">final.ipdw</span>,  main <span class="op">=</span> <span class="st">"IDW versus IPDW"</span><span class="op">)</span></span></code></pre></div>
<p><img src="images/plot_ipdw_vs_idw-1.png" style="display: block; margin: auto;"></p>
<p>We can compare interpolation errors quantitatively using the <code>errorGen</code> function. Figure 3 shows a plot of the validation dataset against the interpolated estimates at those points. The validation dataset enters into the function both as a <code>SpatialPointsDataFrame</code> object and as the underlying values contained in the data slot.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">measured.spdf</span>              <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">validate</span><span class="op">$</span><span class="va">salinity</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/sp/man/coordinates.html" class="external-link">coordinates</a></span><span class="op">(</span><span class="va">measured.spdf</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sp/man/coordinates.html" class="external-link">coordinates</a></span><span class="op">(</span><span class="va">validate</span><span class="op">)</span></span>
<span></span>
<span><span class="va">valid.ipdw</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/errorGen.html">errorGen</a></span><span class="op">(</span><span class="va">final.ipdw</span>, <span class="va">measured.spdf</span>, <span class="va">measured.spdf</span><span class="op">@</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="va">valid.idw</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/errorGen.html">errorGen</a></span><span class="op">(</span><span class="va">final.idw</span>, <span class="va">measured.spdf</span>, <span class="va">measured.spdf</span><span class="op">@</span><span class="va">data</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">valid.ipdw</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/errorGen.html">errorGen</a></span><span class="op">(</span><span class="va">final.ipdw</span>, <span class="va">measured.spdf</span>, <span class="va">measured.spdf</span><span class="op">@</span><span class="va">data</span>,</span>
<span>  plot <span class="op">=</span> <span class="cn">TRUE</span>, title <span class="op">=</span> <span class="st">"IPDW"</span><span class="op">)</span></span>
<span><span class="va">valid.idw</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/errorGen.html">errorGen</a></span><span class="op">(</span><span class="va">final.idw</span>, <span class="va">measured.spdf</span>, <span class="va">measured.spdf</span><span class="op">@</span><span class="va">data</span>,</span>
<span>  plot <span class="op">=</span> <span class="cn">TRUE</span>, title <span class="op">=</span> <span class="st">"IDW"</span><span class="op">)</span></span></code></pre></div>
<p><img src="images/plot_validation-1.png" style="display: block; margin: auto;"></p>
<p>Results from IDW and IPDW appear similar because no validation points are present in the area downstream (south) of the contiguous barrier (Figure 1, 2). Up to this point, we have seen a simple implementation of IPDW requiring only a <code>SpatialPointsDataFrame</code> and a cost <code>Raster</code>.</p>
<p>Test comparisons between the <code>ipdw</code> and the ESRI <span class="citation">(Mitchell 2012; Suominen, Tolvanen, and Kalliola 2010)</span> implementations of IPDW found <code>ipdw</code> to be much faster and more flexible. In particular, the high-level function <code>ipdw</code> provides the ability to run IPDW in one step while the lower-level function <code>ipdwInterp</code> can be called multiple times following <code>pathdistGen</code> in order to interpolate multiple parameters of a single <code>SpatialPointsDataFrame</code>. This is accomplished by saving the output from <code>pathdistGen</code>.</p>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references hanging-indent">
<div id="ref-bad2005">
<p>Baddeley, Adrian, and Rolf Turner. 2005. “Spatstat: An R Package for Analyzing Spatial Point Patterns.” <em>Journal of Statistical Software</em> 12 (6): 1–42.</p>
</div>
<div id="ref-csardi2006">
<p>Csardi, Gabor, and Tamas Nepusz. 2006. “The Igraph Software Package for Complex Network Research.” <em>InterJournal, Complex Systems</em> 1695 (5).</p>
</div>
<div id="ref-diggle2006">
<p>Diggle, Peter, and Søren Lophaven. 2006. “Bayesian Geostatistical Design.” <em>Scandinavian Journal of Statistics</em> 33 (1): 53–64.</p>
</div>
<div id="ref-etten2014">
<p>Etten, Jacob van. 2014. <em>Gdistance: Distances and Routes on Geographical Grids</em>. <a href="https://cran.r-project.org/package=gdistance" class="external-link">https://cran.r-project.org/package=gdistance</a>.</p>
</div>
<div id="ref-hij2014">
<p>Hijmans, Robert. 2014. <em>Raster:Raster: Geographic Data Analysis and Modeling</em>. <a href="https://CRAN.R-project.org/package=raster" class="external-link">https://CRAN.R-project.org/package=raster</a>.</p>
</div>
<div id="ref-little1997">
<p>Little, L, D Edwards, and D Porter. 1997. “Kriging in Estuaries: As the Crow Flies or as the Fish Swims?” <em>Journal of Experimental Marine Biology and Ecology</em> 213.</p>
</div>
<div id="ref-mitchell2012">
<p>Mitchell, Andy. 2012. <em>The Esri Guide to Gis Analysis, Volume 3: Modeling Suitability, Movement, and Interaction</em>. Esri Press.</p>
</div>
<div id="ref-peb2004">
<p>Pebesma, Edzer J. 2004. “Multivariable Geostatistics in S: The Gstat Package.” <em>Computers and Geosciences</em> 30: 683–91.</p>
</div>
<div id="ref-stachelek_application_2015">
<p>Stachelek, J., and Christopher J. Madden. 2015. “Application of Inverse Path Distance Weighting for High-Density Spatial Mapping of Coastal Water Quality Patterns.” <em>International Journal of Geographical Information Science</em> 29 (7): 1240–50. <a href="https://doi.org/10.1080/13658816.2015.1018833" class="external-link">https://doi.org/10.1080/13658816.2015.1018833</a>.</p>
</div>
<div id="ref-suominen2010">
<p>Suominen, Tapio, Harri Tolvanen, and Risto Kalliola. 2010. “Surface Layer Salinity Gradients and Flow Patterns in the Archipelago Coast of Sw Finland, Northern Baltic Sea.” <em>Marine Environmental Research</em> 69 (4): 216–26.</p>
</div>
<div id="ref-warn2014">
<p>Warnes, Gregory R., Ben Bolker, Gregor Gorjanc, Gabor Grothendieck, Ales Korosec, Thomas Lumley, Don MacQueen, Arni Magnusson, and Jim Rogers. 2014. <em>Gdata: Various R Programming Tools for Data Manipulation</em>. <a href="https://cran.r-project.org/package=gdata" class="external-link">https://cran.r-project.org/package=gdata</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jemma Stachelek.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
